<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Web Capture Extension - PromptSync</title>
  <link rel="icon" type="image/x-icon" href="../../assets/favicon.ico" />
  <link rel="stylesheet" href="../../src/styles.css" />
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-functions-compat.js"></script>
  <script src="../../src/firebase-init.js"></script>
</head>
<body data-page="webcapture">

  <div class="wrap">
    <main class="card pad-lg">
      <h2 class="section-title-lg font-28 mb-lg">üì∏ PromptSync Web Capture</h2>
      
      <div class="hero-panel">
        <h3 class="hero-title">Capture Any Webpage as Markdown</h3>
        <p class="hero-desc">
          A browser extension that converts any webpage to clean Markdown and syncs it directly to your GitHub repository.
        </p>
        <button id="downloadExtensionBtn" class="btn primary xl fw-600">
          ‚¨áÔ∏è Download Extension
        </button>
        <p class="hero-note">Compatible with Chrome, Edge, Brave, and other Chromium browsers</p>
      </div>

      <!-- Features -->
      <div class="section-mb">
        <h3 class="section-heading">‚ú® Features</h3>
        <div class="feature-grid">
          <div class="feature-card">
            <div class="feature-icon">üíæ</div>
            <div class="feature-content">
              <div class="feature-title">One-Click Capture</div>
              <div class="feature-desc">Click the extension icon to save any webpage instantly</div>
            </div>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üìù</div>
            <div class="feature-content">
              <div class="feature-title">Markdown Conversion</div>
              <div class="feature-desc">Automatically converts HTML to clean, readable Markdown</div>
            </div>
          </div>
          <div class="feature-card">
            <div class="feature-icon">‚òÅÔ∏è</div>
            <div class="feature-content">
              <div class="feature-title">GitHub Sync</div>
              <div class="feature-desc">Automatically sync captures to your GitHub repository</div>
            </div>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üîê</div>
            <div class="feature-content">
              <div class="feature-title">Secure OAuth</div>
              <div class="feature-desc">Connect via GitHub OAuth - no personal access tokens needed</div>
            </div>
          </div>
          <div class="feature-card">
            <div class="feature-icon">üìä</div>
            <div class="feature-content">
              <div class="feature-title">Smart Extraction</div>
              <div class="feature-desc">Removes navigation, ads, and clutter - keeps only the content</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Installation Instructions -->
      <div class="section-mb">
        <h3 class="section-heading">üì¶ Installation Instructions</h3>
        
        <div class="instruction-panel">
          <h4 class="section-subheading">Chrome / Edge / Brave</h4>
          
          <ol class="instruction-list">
            <li class="instruction-item">
              <strong class="instruction-strong">Download the extension</strong><br/>
              Click the "Download Extension" button above to download the extension files
            </li>
            <li class="instruction-item">
              <strong class="instruction-strong">Extract the files</strong><br/>
              Unzip the downloaded file to a location on your computer (e.g., Documents/PromptSync-Extension)
            </li>
            <li class="instruction-item">
              <strong class="instruction-strong">Open Extensions Page</strong><br/>
              Navigate to <code class="code-inline">chrome://extensions/</code> (Chrome) or <code class="code-inline">edge://extensions/</code> (Edge) or <code class="code-inline">brave://extensions/</code> (Brave)
            </li>
            <li class="instruction-item">
              <strong class="instruction-strong">Enable Developer Mode</strong><br/>
              Toggle the "Developer mode" switch in the top-right corner
            </li>
            <li class="instruction-item">
              <strong class="instruction-strong">Load the Extension</strong><br/>
              Click "Load unpacked", navigate to the extracted folder, and select it
            </li>
            <li class="instruction-item">
              <strong class="instruction-strong">Pin the Extension</strong> (optional)<br/>
              Click the puzzle piece icon in your browser toolbar, find "PromptSync Web Capture", and click the pin icon
            </li>
          </ol>
        </div>
      </div>

      <!-- How to Use -->
      <div class="section-mb">
        <h3 class="section-heading">üöÄ How to Use</h3>
        
        <div class="instruction-panel">
          <ol class="instruction-list">
            <li class="instruction-item">
              <strong class="instruction-strong">Navigate to any webpage</strong> you want to capture
            </li>
            <li class="instruction-item">
              <strong class="instruction-strong">Click the extension icon</strong> in your browser toolbar
            </li>
            <li class="instruction-item">
              <strong class="instruction-strong">Choose your action:</strong>
              <ul class="instruction-sublist">
                <li>Click "üì∏ Capture Page" to convert to Markdown and download locally</li>
                <li>Click "‚òÅÔ∏è Sync to GitHub" to save directly to your repository (requires authentication)</li>
              </ul>
            </li>
            <li class="instruction-item">
              <strong class="instruction-strong">View your captures</strong> in the <code class="code-inline">webclips/</code> folder of your repository
            </li>
          </ol>
        </div>
      </div>

      <!-- GitHub Setup -->
      <div class="section-mb">
        <h3 class="section-heading">üîó GitHub Setup</h3>
        
        <div class="instruction-panel">
          <p class="muted-text lh-16 mb-md">
            To sync captures directly to GitHub, you'll need to authenticate the extension with your GitHub account:
          </p>
          <ol class="instruction-list">
            <li class="instruction-item">
              Open the extension popup (click the extension icon)
            </li>
            <li class="instruction-item">
              Click "üîê Connect to GitHub"
            </li>
            <li class="instruction-item">
              Authorize the PromptSync app on GitHub
            </li>
            <li class="instruction-item">
              You're all set! The extension will now sync captures to your repository automatically
            </li>
          </ol>
        </div>
      </div>

      <!-- Troubleshooting -->
      <div>
        <h3 class="section-heading">üîß Troubleshooting</h3>
        
        <div class="instruction-panel">
          <div class="mb-md">
            <strong class="instruction-strong">Extension not appearing after installation?</strong>
            <p class="muted-text small-text" style="margin:4px 0 0;">
              Make sure Developer Mode is enabled and you selected the correct folder. The folder should contain the manifest.json file.
            </p>
          </div>
          <div class="mb-md">
            <strong class="instruction-strong">GitHub sync not working?</strong>
            <p class="muted-text small-text" style="margin:4px 0 0;">
              Check that you're authenticated by opening the extension popup and verifying your GitHub username is displayed.
            </p>
          </div>
          <div>
            <strong class="instruction-strong">Capture quality issues?</strong>
            <p class="muted-text small-text" style="margin:4px 0 0;">
              Some websites with complex layouts may not convert perfectly. Try refreshing the page before capturing or report issues on GitHub.
            </p>
          </div>
        </div>
      </div>

    </main>
  </div>

  <!-- Status Bar -->
  <div id="statusBar" class="hidden" aria-live="polite">
    <div class="status-inner">
      <div class="status-msg" style="flex:1;">Ready</div>
      <div class="status-progress hidden" style="margin-left:12px;"></div>
      <button class="status-action btn hidden" style="margin-left:12px; padding:6px 10px;">Action</button>
    </div>
  </div>

  <script type="module" src="../../src/shared-init.js"></script>
  <script type="module">
    function waitForComponents() {
      if (document.querySelector('header')) {
        initApp();
      } else {
        setTimeout(waitForComponents, 50);
      }
    }

    function initApp() {
      // Download extension button
      const downloadBtn = document.getElementById('downloadExtensionBtn');
      if (downloadBtn && !downloadBtn.dataset.bound) {
        downloadBtn.dataset.bound = 'true';
        downloadBtn.addEventListener('click', async () => {
          try {
            downloadBtn.disabled = true;
            downloadBtn.textContent = '‚è≥ Preparing download...';

            // Import JSZip dynamically (ESM via CDN)
            const JSZip = (await import('https://cdn.jsdelivr.net/npm/jszip@3.10.1/+esm')).default;
            const zip = new JSZip();

            // Extension files to include
            const files = [
              '../../browser-extension/manifest.json',
              '../../browser-extension/background.js',
              '../../browser-extension/config.js',
              '../../browser-extension/content.js',
              '../../browser-extension/github-auth.js',
              '../../browser-extension/github-sync.js',
              '../../browser-extension/popup.html',
              '../../browser-extension/popup.css',
              '../../browser-extension/popup.js',
              '../../browser-extension/README.md'
            ];

            // Fetch and add each file to zip
            for (const filePath of files) {
              try {
                const response = await fetch(filePath);
                if (response.ok) {
                  const content = await response.text();
                  const fileName = filePath.replace('/browser-extension/', '');
                  zip.file(fileName, content);
                }
              } catch (error) {
                console.error(`Failed to fetch ${filePath}:`, error);
              }
            }

            // Generate zip file
            const blob = await zip.generateAsync({ type: 'blob' });

            // Create download link
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'promptsync-web-capture-extension.zip';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            downloadBtn.textContent = '‚úÖ Downloaded!';
            setTimeout(() => {
              downloadBtn.textContent = '‚¨áÔ∏è Download Extension';
              downloadBtn.disabled = false;
            }, 2000);
          } catch (error) {
            console.error('Download failed:', error);
            downloadBtn.textContent = '‚ùå Download failed';
            setTimeout(() => {
              downloadBtn.textContent = '‚¨áÔ∏è Download Extension';
              downloadBtn.disabled = false;
            }, 2000);
          }
        });
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', waitForComponents);
    } else {
      waitForComponents();
    }
  </script>
</body>
</html>
