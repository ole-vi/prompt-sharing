<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Web Capture Extension - PromptSync</title>
  <link rel="icon" type="image/x-icon" href="../../assets/favicon.ico" />
  <link rel="stylesheet" href="../../src/styles.css" />
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-functions-compat.js"></script>
  <script src="../../src/firebase-init.js"></script>
</head>
<body data-page="webcapture">

  <div class="wrap">
    <main class="card pad-lg">
      <h2 class="section-title-lg">üì∏ PromptSync Web Capture</h2>
      
      <div class="panel text-center pad-xl mb-md">
        <h3 class="section-title">Capture Any Webpage as Markdown</h3>
        <p class="muted-text mb-md">A browser extension that converts any webpage to clean Markdown and syncs it directly to your GitHub repository.</p>
        <button id="downloadExtensionBtn" class="btn primary xl">‚¨áÔ∏è Download Extension</button>
        <p class="muted-text small-text mt-md">Compatible with Chrome, Edge, Brave, and other Chromium browsers</p>
      </div>

      <!-- Features -->
      <div class="mb-md">
        <h3 class="section-title">‚ú® Features</h3>
        <div class="grid gap-sm">
          <div class="panel panel-tight row">
            <div>üíæ</div>
            <div>
              <strong class="small-text">One-Click Capture</strong>
              <div class="muted-text small-text">Click the extension icon to save any webpage instantly</div>
            </div>
          </div>
          <div class="panel panel-tight row">
            <div>üìù</div>
            <div>
              <strong class="small-text">Markdown Conversion</strong>
              <div class="muted-text small-text">Automatically converts HTML to clean, readable Markdown</div>
            </div>
          </div>
          <div class="panel panel-tight row">
            <div>‚òÅÔ∏è</div>
            <div>
              <strong class="small-text">GitHub Sync</strong>
              <div class="muted-text small-text">Automatically sync captures to your GitHub repository</div>
            </div>
          </div>
          <div class="panel panel-tight row">
            <div>üîê</div>
            <div>
              <strong class="small-text">Secure OAuth</strong>
              <div class="muted-text small-text">Connect via GitHub OAuth - no personal access tokens needed</div>
            </div>
          </div>
          <div class="panel panel-tight row">
            <div>üìä</div>
            <div>
              <strong class="small-text">Smart Extraction</strong>
              <div class="muted-text small-text">Removes navigation, ads, and clutter - keeps only the content</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Installation Instructions -->
      <div class="mb-md">
        <h3 class="section-title">üì¶ Installation Instructions</h3>
        
        <div class="panel pad-lg">
          <h4 class="small-text">Chrome / Edge / Brave</h4>
          
          <ol class="guidelist muted-text">
            <li>
              <strong>Download the extension</strong><br/>
              Click the "Download Extension" button above to download the extension files
            </li>
            <li>
              <strong>Extract the files</strong><br/>
              Unzip the downloaded file to a location on your computer (e.g., Documents/PromptSync-Extension)
            </li>
            <li>
              <strong>Open Extensions Page</strong><br/>
              Navigate to <code class="mono">chrome://extensions/</code> (Chrome) or <code class="mono">edge://extensions/</code> (Edge) or <code class="mono">brave://extensions/</code> (Brave)
            </li>
            <li>
              <strong>Enable Developer Mode</strong><br/>
              Toggle the "Developer mode" switch in the top-right corner
            </li>
            <li>
              <strong>Load the Extension</strong><br/>
              Click "Load unpacked", navigate to the extracted folder, and select it
            </li>
            <li>
              <strong>Pin the Extension</strong> (optional)<br/>
              Click the puzzle piece icon in your browser toolbar, find "PromptSync Web Capture", and click the pin icon
            </li>
          </ol>
        </div>
      </div>

      <!-- How to Use -->
      <div class="mb-md">
        <h3 class="section-title">üöÄ How to Use</h3>
        
        <div class="panel pad-lg">
          <ol class="guidelist muted-text">
            <li>
              <strong>Navigate to any webpage</strong> you want to capture
            </li>
            <li>
              <strong>Click the extension icon</strong> in your browser toolbar
            </li>
            <li>
              <strong>Choose your action:</strong>
              <ul class="guidelist mt-md">
                <li>Click "üì∏ Capture Page" to convert to Markdown and download locally</li>
                <li>Click "‚òÅÔ∏è Sync to GitHub" to save directly to your repository (requires authentication)</li>
              </ul>
            </li>
            <li>
              <strong>View your captures</strong> in the <code class="mono">webclips/</code> folder of your repository
            </li>
          </ol>
        </div>
      </div>

      <!-- GitHub Setup -->
      <div class="mb-md">
        <h3 class="section-title">üîó GitHub Setup</h3>
        
        <div class="panel pad-lg">
          <p class="muted-text mb-md">
            To sync captures directly to GitHub, you'll need to authenticate the extension with your GitHub account:
          </p>
          <ol class="guidelist muted-text">
            <li>Open the extension popup (click the extension icon)</li>
            <li>Click "üîê Connect to GitHub"</li>
            <li>Authorize the PromptSync app on GitHub</li>
            <li>You're all set! The extension will now sync captures to your repository automatically</li>
          </ol>
        </div>
      </div>

      <!-- Troubleshooting -->
      <div>
        <h3 class="section-title">üîß Troubleshooting</h3>
        
        <div class="panel pad-lg">
          <div class="mb-md">
            <strong>Extension not appearing after installation?</strong>
            <p class="muted-text small-text mt-md">
              Make sure Developer Mode is enabled and you selected the correct folder. The folder should contain the manifest.json file.
            </p>
          </div>
          <div class="mb-md">
            <strong>GitHub sync not working?</strong>
            <p class="muted-text small-text mt-md">
              Check that you're authenticated by opening the extension popup and verifying your GitHub username is displayed.
            </p>
          </div>
          <div>
            <strong>Capture quality issues?</strong>
            <p class="muted-text small-text mt-md">
              Some websites with complex layouts may not convert perfectly. Try refreshing the page before capturing or report issues on GitHub.
            </p>
          </div>
        </div>
      </div>

    </main>
  </div>

  <!-- Status Bar -->
  <div id="statusBar" style="display:none;" aria-live="polite">
    <div class="status-inner">
      <div class="status-msg" style="flex:1;">Ready</div>
      <div class="status-progress" style="display:none;"></div>
      <button class="status-action btn" style="display:none;">Action</button>
    </div>
  </div>

  <script type="module" src="../../src/shared-init.js"></script>
  <script type="module">
    function waitForComponents() {
      if (document.querySelector('header')) {
        initApp();
      } else {
        setTimeout(waitForComponents, 50);
      }
    }

    function initApp() {
      // Download extension button
      const downloadBtn = document.getElementById('downloadExtensionBtn');
      if (downloadBtn && !downloadBtn.dataset.bound) {
        downloadBtn.dataset.bound = 'true';
        downloadBtn.addEventListener('click', async () => {
          try {
            downloadBtn.disabled = true;
            downloadBtn.textContent = '‚è≥ Preparing download...';

            // Import JSZip dynamically (ESM via CDN)
            const JSZip = (await import('https://cdn.jsdelivr.net/npm/jszip@3.10.1/+esm')).default;
            const zip = new JSZip();

            // Extension files to include
            const files = [
              '../../browser-extension/manifest.json',
              '../../browser-extension/background.js',
              '../../browser-extension/config.js',
              '../../browser-extension/content.js',
              '../../browser-extension/github-auth.js',
              '../../browser-extension/github-sync.js',
              '../../browser-extension/popup.html',
              '../../browser-extension/popup.css',
              '../../browser-extension/popup.js',
              '../../browser-extension/README.md'
            ];

            // Fetch and add each file to zip
            for (const filePath of files) {
              try {
                const response = await fetch(filePath);
                if (response.ok) {
                  const content = await response.text();
                  const fileName = filePath.replace('/browser-extension/', '');
                  zip.file(fileName, content);
                }
              } catch (error) {
                console.error(`Failed to fetch ${filePath}:`, error);
              }
            }

            // Generate zip file
            const blob = await zip.generateAsync({ type: 'blob' });

            // Create download link
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'promptsync-web-capture-extension.zip';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            downloadBtn.textContent = '‚úÖ Downloaded!';
            setTimeout(() => {
              downloadBtn.textContent = '‚¨áÔ∏è Download Extension';
              downloadBtn.disabled = false;
            }, 2000);
          } catch (error) {
            console.error('Download failed:', error);
            downloadBtn.textContent = '‚ùå Download failed';
            setTimeout(() => {
              downloadBtn.textContent = '‚¨áÔ∏è Download Extension';
              downloadBtn.disabled = false;
            }, 2000);
          }
        });
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', waitForComponents);
    } else {
      waitForComponents();
    }
  </script>
</body>
</html>
