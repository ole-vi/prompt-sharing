<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Web Capture Extension - PromptSync</title>
  <link rel="icon" type="image/x-icon" href="../../assets/favicon.ico" />
  
  <!-- Core Styles -->
  <link rel="stylesheet" href="../../src/styles/core/variables.css" />
  <link rel="stylesheet" href="../../src/styles/core/reset.css" />
  <link rel="stylesheet" href="../../src/styles/core/animations.css" />
  
  <!-- Layout Styles -->
  <link rel="stylesheet" href="../../src/styles/layout/header.css" />
  <link rel="stylesheet" href="../../src/styles/layout/main.css" />
  <link rel="stylesheet" href="../../src/styles/layout/content.css" />
  
  <!-- Component Styles -->
  <link rel="stylesheet" href="../../src/styles/components/cards.css" />
  <link rel="stylesheet" href="../../src/styles/components/buttons.css" />
  <link rel="stylesheet" href="../../src/styles/components/dropdowns.css" />
  
  <!-- Utilities -->
  <link rel="stylesheet" href="../../src/styles/utilities.css" />
  
  <!-- Responsive Styles -->
  <link rel="stylesheet" href="../../src/styles/media-queries.css" />
  
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-functions-compat.js"></script>
  <script src="../../firebase-init.js"></script>
</head>
<body data-page="webcapture">

  <div class="wrap grid-cols-1">
    <main class="card content-box--large">
      <h1 class="page-header mb-24">üì∏ PromptSync Web Capture</h1>
      
      <div class="message-box mb-40 text-center">
        <h3 class="mb-12" style="font-size:20px; font-weight:600;">Capture Any Webpage as Markdown</h3>
        <p class="message-box__text mb-24" style="font-size:15px; line-height:1.6;">
          A browser extension that converts any webpage to clean Markdown and syncs it directly to your GitHub repository.
        </p>
        <button id="downloadExtensionBtn" class="btn primary" style="padding:16px 32px; font-size:16px; font-weight:600; cursor:pointer;">
          ‚¨áÔ∏è Download Extension
        </button>
        <p class="text-muted text-sm mt-8">Compatible with Chrome, Edge, Brave, and other Chromium browsers</p>
      </div>

      <!-- Features -->
      <div class="mb-40">
        <h3 class="section-heading mb-20">‚ú® Features</h3>
        <div class="flex-col gap-16">
          <div class="feature-card">
            <div class="feature-card__icon">üíæ</div>
            <div>
              <div class="feature-card__title">One-Click Capture</div>
              <div class="feature-card__description">Click the extension icon to save any webpage instantly</div>
            </div>
          </div>
          <div class="feature-card">
            <div class="feature-card__icon">üìù</div>
            <div>
              <div class="feature-card__title">Markdown Conversion</div>
              <div class="feature-card__description">Automatically converts HTML to clean, readable Markdown</div>
            </div>
          </div>
          <div class="feature-card">
            <div class="feature-card__icon">‚òÅÔ∏è</div>
            <div>
              <div class="feature-card__title">GitHub Sync</div>
              <div class="feature-card__description">Automatically sync captures to your GitHub repository</div>
            </div>
          </div>
          <div class="feature-card">
            <div class="feature-card__icon">üîê</div>
            <div>
              <div class="feature-card__title">Secure OAuth</div>
              <div class="feature-card__description">Connect via GitHub OAuth - no personal access tokens needed</div>
            </div>
          </div>
          <div class="feature-card">
            <div class="feature-card__icon">üìä</div>
            <div>
              <div class="feature-card__title">Smart Extraction</div>
              <div class="feature-card__description">Removes navigation, ads, and clutter - keeps only the content</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Installation Instructions -->
      <div class="mb-40">
        <h3 class="section-heading mb-20">üì¶ Installation Instructions</h3>
        
        <div class="content-box">
          <h4 class="mb-16" style="font-size:16px; font-weight:600;">Chrome / Edge / Brave</h4>
          
          <ol style="margin:0; padding-left:24px; line-height:1.8; color:var(--muted);">
            <li style="margin-bottom:12px;">
              <strong style="color:var(--text);">Download the extension</strong><br/>
              Click the "Download Extension" button above to download the extension files
            </li>
            <li style="margin-bottom:12px;">
              <strong style="color:var(--text);">Extract the files</strong><br/>
              Unzip the downloaded file to a location on your computer (e.g., Documents/PromptSync-Extension)
            </li>
            <li style="margin-bottom:12px;">
              <strong style="color:var(--text);">Open Extensions Page</strong><br/>
              Navigate to <code style="background:rgba(0,0,0,0.3); padding:2px 6px; border-radius:4px; font-family:monospace;">chrome://extensions/</code> (Chrome) or <code style="background:rgba(0,0,0,0.3); padding:2px 6px; border-radius:4px; font-family:monospace;">edge://extensions/</code> (Edge) or <code style="background:rgba(0,0,0,0.3); padding:2px 6px; border-radius:4px; font-family:monospace;">brave://extensions/</code> (Brave)
            </li>
            <li style="margin-bottom:12px;">
              <strong style="color:var(--text);">Enable Developer Mode</strong><br/>
              Toggle the "Developer mode" switch in the top-right corner
            </li>
            <li style="margin-bottom:12px;">
              <strong style="color:var(--text);">Load the Extension</strong><br/>
              Click "Load unpacked", navigate to the extracted folder, and select it
            </li>
            <li style="margin-bottom:0;">
              <strong style="color:var(--text);">Pin the Extension</strong> (optional)<br/>
              Click the puzzle piece icon in your browser toolbar, find "PromptSync Web Capture", and click the pin icon
            </li>
          </ol>
        </div>
      </div>

      <!-- How to Use -->
      <div class="mb-40">
        <h3 class="section-heading mb-20">üöÄ How to Use</h3>
        
        <div class="content-box">
          <ol style="margin:0; padding-left:24px; line-height:1.8; color:var(--muted);">
            <li style="margin-bottom:12px;">
              <strong style="color:var(--text);">Navigate to any webpage</strong> you want to capture
            </li>
            <li style="margin-bottom:12px;">
              <strong style="color:var(--text);">Click the extension icon</strong> in your browser toolbar
            </li>
            <li style="margin-bottom:12px;">
              <strong style="color:var(--text);">Choose your action:</strong>
              <ul style="margin:8px 0 0; padding-left:24px;">
                <li>Click "üì∏ Capture Page" to convert to Markdown and download locally</li>
                <li>Click "‚òÅÔ∏è Sync to GitHub" to save directly to your repository (requires authentication)</li>
              </ul>
            </li>
            <li style="margin-bottom:0;">
              <strong style="color:var(--text);">View your captures</strong> in the <code style="background:rgba(0,0,0,0.3); padding:2px 6px; border-radius:4px; font-family:monospace;">webclips/</code> folder of your repository
            </li>
          </ol>
        </div>
      </div>

      <!-- GitHub Setup -->
      <div class="mb-40">
        <h3 class="section-heading mb-20">üîó GitHub Setup</h3>
        
        <div class="content-box">
          <p style="margin:0 0 16px; color:var(--muted); line-height:1.6;">
            To sync captures directly to GitHub, you'll need to authenticate the extension with your GitHub account:
          </p>
          <ol style="margin:0; padding-left:24px; line-height:1.8; color:var(--muted);">
            <li style="margin-bottom:12px;">
              Open the extension popup (click the extension icon)
            </li>
            <li style="margin-bottom:12px;">
              Click "üîê Connect to GitHub"
            </li>
            <li style="margin-bottom:12px;">
              Authorize the PromptSync app on GitHub
            </li>
            <li style="margin-bottom:0;">
              You're all set! The extension will now sync captures to your repository automatically
            </li>
          </ol>
        </div>
      </div>

      <!-- Troubleshooting -->
      <div>
        <h3 class="section-heading mb-20">üîß Troubleshooting</h3>
        
        <div class="content-box">
          <div style="margin-bottom:16px;">
            <strong style="color:var(--text);">Extension not appearing after installation?</strong>
            <p style="margin:4px 0 0; color:var(--muted); font-size:14px;">
              Make sure Developer Mode is enabled and you selected the correct folder. The folder should contain the manifest.json file.
            </p>
          </div>
          <div style="margin-bottom:16px;">
            <strong style="color:var(--text);">GitHub sync not working?</strong>
            <p style="margin:4px 0 0; color:var(--muted); font-size:14px;">
              Check that you're authenticated by opening the extension popup and verifying your GitHub username is displayed.
            </p>
          </div>
          <div style="margin-bottom:0;">
            <strong style="color:var(--text);">Capture quality issues?</strong>
            <p style="margin:4px 0 0; color:var(--muted); font-size:14px;">
              Some websites with complex layouts may not convert perfectly. Try refreshing the page before capturing or report issues on GitHub.
            </p>
          </div>
        </div>
      </div>

    </main>
  </div>

  <script type="module" src="../../src/shared-init.js"></script>
  <script type="module">
    function waitForComponents() {
      if (document.querySelector('header')) {
        initApp();
      } else {
        setTimeout(waitForComponents, 50);
      }
    }

    function initApp() {
      // Download extension button
      const downloadBtn = document.getElementById('downloadExtensionBtn');
      if (downloadBtn) {
        downloadBtn.addEventListener('click', async () => {
          try {
            downloadBtn.disabled = true;
            downloadBtn.textContent = '‚è≥ Preparing download...';
            
            // Import JSZip dynamically
            const JSZip = (await import('https://cdn.jsdelivr.net/npm/jszip@3.10.1/+esm')).default;
            const zip = new JSZip();
            
            // Extension files to include
            const files = [
              'browser-extension/manifest.json',
              'browser-extension/background.js',
              'browser-extension/config.js',
              'browser-extension/content.js',
              'browser-extension/github-auth.js',
              'browser-extension/github-sync.js',
              'browser-extension/popup.html',
              'browser-extension/popup.css',
              'browser-extension/popup.js',
              'browser-extension/README.md'
            ];
            
            // Fetch and add each file to zip
            for (const filePath of files) {
              try {
                const response = await fetch(filePath);
                if (response.ok) {
                  const content = await response.text();
                  const fileName = filePath.replace('browser-extension/', '');
                  zip.file(fileName, content);
                }
              } catch (error) {
                console.error(`Failed to fetch ${filePath}:`, error);
              }
            }
            
            // Generate zip file
            const blob = await zip.generateAsync({ type: 'blob' });
            
            // Create download link
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'promptsync-web-capture-extension.zip';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            downloadBtn.textContent = '‚úÖ Downloaded!';
            setTimeout(() => {
              downloadBtn.textContent = '‚¨áÔ∏è Download Extension';
              downloadBtn.disabled = false;
            }, 2000);
          } catch (error) {
            console.error('Download failed:', error);
            downloadBtn.textContent = '‚ùå Download failed';
            setTimeout(() => {
              downloadBtn.textContent = '‚¨áÔ∏è Download Extension';
              downloadBtn.disabled = false;
            }, 2000);
          }
        });
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', waitForComponents);
    } else {
      waitForComponents();
    }
  </script>

  <!-- Status Bar -->
  <div id="statusBar" style="display:none;" aria-live="polite">
    <div class="status-inner">
      <div class="status-msg" style="flex:1;">Ready</div>
      <div class="status-progress" style="display:none; margin-left:12px; color:var(--muted); font-size:13px;"></div>
      <button class="status-action btn" style="display:none; margin-left:12px; padding:6px 10px;">Action</button>
    </div>
  </div>

</body>
</html>
